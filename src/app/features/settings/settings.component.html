<div class="settings-container">
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading settings...</p>
    </div>
  } @else {
    <div class="settings-header">
      <h1>Settings</h1>
      <p class="subtitle">Manage your account and preferences</p>
    </div>

    @if (error()) {
      <div class="error-message">
        {{ error() }}
      </div>
    }

    @if (success()) {
      <div class="success-message">
        {{ success() }}
      </div>
    }

    <!-- Account Section -->
    <div class="settings-section">
      <h2>Account</h2>
      <div class="settings-card">
        <div class="info-row">
          <div class="info-label">Name</div>
          <div class="info-value">{{ profile()?.firstName }} {{ profile()?.lastName }}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Email</div>
          <div class="info-value">{{ profile()?.email }}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Username</div>
          <div class="info-value">{{ profile()?.username }}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Age</div>
          <div class="info-value">{{ authService.getUserAge() || 'Not set' }}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Email Verified</div>
          <div class="info-value">
            <span class="badge" [class.badge-success]="profile()?.emailVerified" [class.badge-warning]="!profile()?.emailVerified">
              {{ profile()?.emailVerified ? 'Verified' : 'Not Verified' }}
            </span>
          </div>
        </div>
        
        <div class="action-row">
          <button type="button" class="btn btn-secondary" (click)="openKeycloakAccount()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 8v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2h4M10 2h4v4M14 2L8 8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Edit in Keycloak
          </button>
        </div>
      </div>
    </div>

    <!-- Privacy & Data Section -->
    <div class="settings-section">
      <h2>Privacy & Data</h2>
      <div class="settings-card">
        <div class="info-row">
          <div class="info-label">Data Export</div>
          <div class="info-value">
            <p class="help-text">Request a copy of your health metrics data</p>
            <button type="button" class="btn btn-outline" disabled>
              Export Data (Coming Soon)
            </button>
          </div>
        </div>
        
        <div class="info-row danger-zone">
          <div class="info-label">Delete All Data</div>
          <div class="info-value">
            <p class="help-text">Permanently delete all your health metrics and account data. This action cannot be undone.</p>
            <button 
              type="button" 
              class="btn btn-danger" 
              (click)="deleteAllData()"
              [disabled]="deleting()">
              @if (deleting()) {
                <span class="spinner-small"></span>
                Deleting...
              } @else {
                Delete All My Data
              }
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- About Section -->
    <div class="settings-section">
      <h2>About</h2>
      <div class="settings-card">
        <div class="info-row">
          <div class="info-label">Privacy Policy</div>
          <div class="info-value">
            <a href="https://github.com/dkuechler/appleWatch-Zone2-pilot/blob/main/PRIVACY.md" target="_blank" rel="noopener noreferrer" class="link">
              View Privacy Policy
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 2v4M10 2h-4M10 2L4 8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">User ID</div>
          <div class="info-value">
            <code class="user-id">{{ authService.getUserId() || 'N/A' }}</code>
          </div>
        </div>
      </div>
    </div>
  }
</div>
