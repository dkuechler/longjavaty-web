<div class="dashboard-container">
  @if (allMetrics$ | async; as metrics) {
    @if (metrics.length > 0) {
      <!-- Chart Section -->
      <div class="chart-container">
        <div class="chart-header">
          <div>
            <h2>Metrics Timeline</h2>
            <p class="chart-description">Track your health metrics over time</p>
          </div>
          
          <!-- Metric Filter Buttons -->
          <div class="metric-filters">
            <button 
              class="filter-btn" 
              [class.active]="isFilterActive('all')"
              (click)="setFilter('all')"
            >
              All Metrics
            </button>
            @for (metric of metrics; track metric.measurementType) {
              <button 
                class="filter-btn" 
                [class.active]="isFilterActive(metric.measurementType)"
                [style.--metric-color]="metric.color"
                (click)="setFilter(metric.measurementType)"
              >
                {{ metric.label }}
              </button>
            }
          </div>
        </div>
        
        <div class="chart-wrapper">
          <canvas
            baseChart
            [data]="lineChartData()"
            [options]="lineChartOptions()"
            [type]="lineChartType"
          ></canvas>
        </div>

        <!-- Custom Legend -->
        <div class="metrics-legend">
          @for (metric of metrics; track metric.measurementType) {
            @if (metric.data.length > 0) {
              <div
                class="legend-item"
                [class.hovered]="isMetricHovered(metric.measurementType)"
                (mouseenter)="onMetricHover(metric.measurementType)"
                (mouseleave)="onMetricLeave()"
              >
                <div class="legend-color" [style.background-color]="metric.color"></div>
                <div class="legend-content">
                  <span class="legend-label">{{ metric.label }}</span>
                  <span class="legend-value">
                    {{ metric.data[metric.data.length - 1].value }}
                    {{ metric.data[metric.data.length - 1].unit }}
                  </span>
                </div>
                <div class="legend-indicator">
                  <svg width="16" height="16" viewBox="0 0 16 16" aria-label="Trending up">
                    <path
                      d="M2 8 L8 2 L14 8"
                      stroke="currentColor"
                      stroke-width="2"
                      fill="none"
                    />
                  </svg>
                </div>
              </div>
            }
          }
        </div>
      </div>
    } @else {
      <div class="empty-state">
        <div class="empty-icon">ðŸ“Š</div>
        <h2>No Data Yet</h2>
        <p>Start tracking your health metrics to see insights here.</p>
      </div>
    }
  } @else {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading your health metrics...</p>
    </div>
  }
</div>
